define(["underscore","config","helpers"],function(e,t,n){function i(e,t){var n="";symbolPairs&&(n=JSON.parse(symbolPairs.replace(/&quot;/gi,'"')));var i=t.message,a=Object.keys(n),o=[],r=[],c=0;$.each(i,function(e,t){c=a.indexOf(t.name),c!=-1?o[c]=t:r.push(t)});var s=o.concat(r);i=s,u.addClass("changed"),setTimeout(function(){u.removeClass("changed")},100),m.empty();for(var l=0;l<Object.keys(n).length;l++)if(i[l]){var f=i[l],d=(100-f.last_price/(f.bid/100)).toFixed(2);m.append(e.itemTemplate({name:f.symbol_name,value:isFinite(n[f.name])?parseFloat(f.bid,10).toFixed(n[f.name]):parseFloat(f.bid,10).toFixed(5),diff:(d>0?"+":"")+d+"%",aff:d>=0?"aff":""}))}var p=0;m.children().each(function(){p+=1*$(this).width()}),m.width(p)}function a(){f.append(m)}function o(e){var t=e.touches[0].pageX-s;f.prop({scrollLeft:1*l+t*-1})}function r(){p.on("click",function(e){var t=f.scrollLeft(),n=2*$(e.target).is(".right")-1;f.stop().animate({scrollLeft:t+120*n},300)}),(n.isTablet()||n.isMobile())&&(u[0].addEventListener("touchstart",function(e){s=e.touches[0].pageX,l=f.scrollLeft(),u[0].addEventListener("touchmove",o,!1)},!1),u[0].addEventListener("touchend",function(e){u[0].removeEventListener("touchmove",o,!1)},!1))}function c(t){t.itemTemplate||(t.itemTemplate=e.template(d.html()),d.remove())}var s,l,u=$("#tradeView"),f=u.children(".inner"),d=f.children("script"),p=$(".arrow",u),m=$("<div/>",{"class":"scrollablePanel"});return{itemTemplate:null,init:function(){a()},update:function(e){var t=this;c(t),i(t,e),r()},apply:function(){var e=this;c(e),a(),u.on("init update",function(){$.ajax({url:t.getQuotesUrl,success:function(t){i(e,t)},error:function(e){},complete:function(){}})}),u.trigger("init");setInterval(function(){u.trigger("update")},3e3);r()}}});