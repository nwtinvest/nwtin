define(["numeral","helpers"],function(t,i){function o(t){return this.start=1,this.end=1,this.position=1,this.sliderRow=t,this.sliderPoint=$(".point",t),this.sliderPointRole=$('[data-role="point"]',t),this.init(),this}function e(t){return this.start=$(".start",t),this.end=$(".end",t),this.center=$(".center",t),this}function n(t){var i=this;return this.sliderLegend=new e($(".slider-legend",t)),this.sliderRow=new o($(".slider",t)),$(this.sliderRow).on("change",function(){$(i).triggerHandler("slider-change")}),this}return o.prototype={init:function(){var t=this,o=function(i){var o=i.clientX;i.touches&&i.touches[0]&&(o=i.touches[0].pageX);var e=(o-t.sliderRow.offset().left)/t.sliderRow.width();t.position=(t.end-t.start)*e+t.start,t.position=Math.min(t.position,t.end),t.position=Math.max(t.position,t.start),$(t).trigger("change");var n;n="touchmove"==i.type?i.changedTouches[0].clientX:i.clientX,t.render(n)};i.isMobile()?(this.sliderPoint.on("touchstart",function(){$(document.body).on("mousemove",o)}),$(document.body).on("touchend",function(){$(document.body).off("mousemove",o)}),this.sliderRow.on("click",function(){$(this).on("click",o)}),this.sliderPoint.length&&this.sliderPoint[0].addEventListener("touchmove",o,!1),window.navigator.msPointerEnabled&&(this.sliderPoint.on("mousedown",function(){$(document.body).on("mousemove",o)}),$(document.body).on("mouseup",function(){$(document.body).off("mousemove",o)}))):(this.sliderPoint.on("mousedown",function(){$(document.body).on("mousemove",o)}),this.sliderRow.on("click",o),$(document.body).on("mouseup",function(){$(document.body).off("mousemove",o)}))},setRange:function(t,i,o){this.start=t,this.end=i,this.position=o},render:function(t){var i=this.sliderPointRole.width(),o=this.sliderRow.width(),e=this.sliderPoint.width(),n=25,s={min:20,middle:80,max:100},d=i/2,r=o/s.max,h=Math.max(d,Math.min(o-d,t-this.sliderRow.offset().left));this.sliderPointRole.css("left",h/(o/s.max)+"%"),h/r>s.middle&&e<n?this.sliderPoint.css("left","calc("+h/r+"% + 8px)"):h/r<s.min&&e<n?this.sliderPoint.css("left","calc("+h/r+"% - 8px)"):this.sliderPoint.css("left","calc("+h/r+"%)")},getPosition:function(){return this.position}},e.prototype={setRange:function(i,o){this.start.html(t(i.toFixed(2)).afFormat()),this.end.html(o),this.end.html(t(o.toFixed(2)).afFormat());var e=parseInt((o+i)/2);this.center.html(t(e.toFixed(2)).afFormat())}},n.prototype={setRange:function(t,i,o){this.sliderLegend.setRange(t,i),this.sliderRow.setRange(t,i,o)},getPosition:function(){return this.sliderRow.getPosition()}},n});