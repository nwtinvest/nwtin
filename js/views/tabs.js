define(["helpers"],function(e){return{apply:function(t,a,n){var i=this;n||$(document).on("platformChanged",function(){i.apply(t,a,!0)}),a=$.extend(!0,{changePanels:!0,tablet:{dropDown:!1},mobile:{swipePanels:!0,clickTabs:!1}},a);var r,s=$(t);if(s.length){var l,o=s,c=o.children(".outer"),d=c.children(".inner").children(".item");a.changePanels&&(l=o.closest(".slide-panel"),r=l.children(".tab-panel"),r.eq(0).css("margin-left",0));var f=o.offset().left,h=f+o.width();d.off("init"),d.off("click"),d.on("init click",function(t){d.removeClass("current"),$(this).addClass("current");var n=$(this).offset().left,i=$(this).offset().left+$(this).outerWidth()-2,s=c.scrollLeft();f>n?c.stop().animate({scrollLeft:s-(f-n)},300):h<i&&c.stop().animate({scrollLeft:s+(i-h)},300);var l=$(this).data("tab");o.data("current-tab",l).attr("data-current-tab",l),o.trigger("tab-change"),"click"==t.type&&o.trigger("tab-clicked",[d.index($(this))]),a.changePanels&&(r.addClass("hide"),r.filter('[data-tab="'+l+'"]').removeClass("hide")),a.tablet.dropDown&&(e.isTablet()||e.isMobile())&&"click"==t.type&&o.toggleClass("expanded")}),d.eq(0).triggerHandler("init"),!e.isDesktop()&&a.mobile.swipePanels&&this.mobileInit(o,c,d,r,l,a)}},mobileInit:function(t,a,n,i,r,s){function l(t){e.isDesktop()||(d=t.touches[0].pageX,r[0].addEventListener("touchmove",o,!1))}function o(e){var t=e.touches[0].pageX-d;(t<-50||t>50)&&r.trigger("swipe",[t])}var c,d,f,h=0,u=!1;if(t.data("markers"))f=t.data("markers");else{f=$("<div/>",{"class":"markers"});for(var m=0;m<n.length;m++)f.append($("<span/>",{"class":"item"}));t.data("markers",f)}var g=$(".item",f);g.removeClass("current"),g.eq(0).addClass("current"),r&&r.length&&(c=i.eq(0),r.after(f),t.data("handlersExists")||(r[0].addEventListener("touchstart",l,!1),r[0].addEventListener("touchend",function(e){r[0].removeEventListener("touchmove",o,!1)},!1),r.on("swipe",function(e,t){return!u&&(r[0].removeEventListener("touchmove",o,!1),u=!0,h=Math.min(n.length-1,Math.max(0,h-(t>0?1:-1))),c.animate({"margin-left":h*-100+"%"},300,function(){setTimeout(function(){u=!1},200)}),n.eq(h).trigger("init"),g.removeClass("current"),void g.eq(h).addClass("current"))}),t.on("tab-clicked",function(t,a){if(e.isMobile()||e.isTablet()){if(h=a,u)return!1;u=!0,c.animate({"margin-left":h*-100+"%"},300,function(){setTimeout(function(){u=!1},200)})}}),t.data("handlersExists",!0)))}}});