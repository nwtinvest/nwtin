define(["numeral","helpers"],function(t,e){return{sliderWidth:null,sliderOffsetLeft:null,apply:function(o,n){function d(t){"INPUT"==l[0].tagName?l.val(t):l.text(t)}function a(){f.text(t(l.val()).afFormat()),l.css({width:f.width()+"px"})}function i(e){var o=$(e.currentTarget),n=parseInt(o.val().replace(/\s/,""),10)||0,i=n/F*100,s=i>100?100:i;a(),d(t(n).afFormat()),n>F&&d(t(F).afFormat()),n<x&&d(t(x).afFormat()),c.attr("data-sum",n).data("sum",n).trigger("slider-change"),w.css("left",s+"%"),b.css("left",s+"%")}function s(t){var e=t.clientX-h.offset().left;r(e)}function r(e){var o=Math.max(W/2,Math.min(u.sliderWidth-W/2,e)),n=(o-W/2)/((u.sliderWidth-W)/100),i=Math.max(x,parseInt(F/100*n));c.attr("data-sum",i).data("sum",i).trigger("slider-change"),d(t(i).afFormat()),w.css("left",o/(u.sliderWidth/100)+"%"),b.css("left",o/(u.sliderWidth/100)+"%"),a(),o/(u.sliderWidth/100)>80&&y.width()<25?y.css("left","calc("+o/(u.sliderWidth/100)+"% + 10px)"):o/(u.sliderWidth/100)<20&&y.width()<25?y.css("left","calc("+o/(u.sliderWidth/100)+"% - 10px)"):y.css("left","calc("+o/(u.sliderWidth/100)+"%)")}var u=this;n||$(document).on("platformChanged",function(){u.apply(o,!0)});var c="string"==typeof o?$(o):o;if(c.length){var l=$('[data-role="sum"]',c),f=$('[data-role="buffer"]',c),m=$('[data-role="sum-area"]',c),h=$('[data-role="slider"]',c),v=$('[data-role="slider-legend"]',c),p=v.children(".start"),g=v.children(".end"),w=$('[data-role="point"]',c),b=$('[data-role="arrow"]',c),y=$(".point",c),W=w.width(),x=parseInt(p.text().replace(/\s/,""),10),F=parseInt(g.text().replace(/\s/,""),10);u.sliderWidth=h.width(),u.sliderOffsetLeft=h.offset().left;var I="INPUT"==l[0].tagName?l.val():l.text();d(t(F).afFormat()),m.width(m.width()+1),u.sliderWidth=h.width(),d(I),c.attr("data-sum",I).data("sum",I),c.trigger("slider-change"),a(),n||(e.isMobile()?(w.on("touchstart",function(){$(document.body).on("mousemove",s)}),b.on("touchstart",function(){$(document.body).on("mousemove",s)}),$(document.body).on("touchend",function(){$(document.body).off("mousemove",s)}),l.on("input",i),w.length&&w[0].addEventListener("touchmove",function(t){var e=t.touches[0].pageX-u.sliderOffsetLeft;r(e)},!1),b.length&&b[0].addEventListener("touchmove",function(t){var e=t.touches[0].pageX-u.sliderOffsetLeft;r(e)},!1),window.navigator.msPointerEnabled&&(w.on("mousedown",function(){$(document.body).on("mousemove",s)}),b.on("mousedown",function(){$(document.body).on("mousemove",s)}),h.on("click",function(){h.on("click",s)}),$(document.body).on("mouseup",function(){$(document.body).off("mousemove",s)}))):(w.on("mousedown",function(){$(document.body).on("mousemove",s)}),b.on("mousedown",function(){$(document.body).on("mousemove",s)}),h.on("click",function(){h.on("click",s)}),$(document.body).on("mouseup",function(){$(document.body).off("mousemove",s)}),l.on("input",i)))}}}});